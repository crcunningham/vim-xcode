#!/usr/bin/env sh

build_path=$(xcodebuild -showBuildSettings "$@" 2>/dev/null | grep -m 1 -E "\bBUILT_PRODUCTS_DIR\b" | sed -E "s/[[:space:]]+BUILT_PRODUCTS_DIR = //")
app_path=$(find "$build_path" -iname "*.app" | grep -m 1 "simulator")
app_id=$(defaults read "$app_path/Info" "CFBundleIdentifier")
uuid=$(xcrun simctl list devices | grep "$SIMULATOR" | head -n1 | grep -E "[0-9A-F-]{8,}" -o)

xcrun simctl install booted "$app_path"
xcrun simctl launch booted "$app_id"
